{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://example.com/provenance/manifest.schema.json",
  "title": "Provenance Manifest",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "version",
    "repo",
    "commit",
    "workflow_run",
    "front_page",
    "artifacts"
  ],
  "properties": {
    "version": { "type": "integer", "minimum": 1 },
    "repo": { "type": "string", "pattern": "^[A-Za-z0-9_.-]+\/[A-Za-z0-9_.-]+$" },
    "commit": { "type": "string", "pattern": "^[0-9a-fA-F]{7,40}$" },
    "workflow_run": {
      "type": "object",
      "additionalProperties": false,
      "required": ["id", "url", "attempt"],
      "properties": {
        "id": { "type": ["integer", "string"] },
        "url": { "type": "string", "format": "uri" },
        "attempt": { "type": "integer", "minimum": 1 }
      }
    },
    "front_page": {
      "type": "object",
      "additionalProperties": false,
      "required": ["title", "markup"],
      "properties": {
        "title": { "type": "string", "minLength": 1 },
        "markup": { "type": "string", "pattern": "^[^\n\r]+$" }
      }
    },
    "artifacts": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["id", "title", "path", "media_type", "render", "sha256"],
        "properties": {
          "id": { "type": "string", "pattern": "^[a-z0-9]([a-z0-9-]*[a-z0-9])?$" },
          "title": { "type": "string", "minLength": 1 },
          "path": { "type": "string", "minLength": 1 },
          "media_type": { "type": "string", "pattern": "^[^\s/]+/[^\s/]+" },
          "render": {
            "type": "string",
            "enum": [
              "markdown",
              "json",
              "table:coverage",
              "summary:test",
              "image",
              "repo:file",
              "repo:bundle",
              "repo:symbols"
            ]
          },
          "sha256": { "type": "string", "pattern": "^[0-9a-f]{64}$" }
        }
      },
      "uniqueItems": true
    }
  },
  "examples": [
    {
      "version": 1,
      "repo": "acme/provenance",
      "commit": "8c6a9f4e0cafe7",
      "workflow_run": { "id": 12345, "url": "https://github.com/acme/provenance/actions/runs/12345", "attempt": 1 },
      "front_page": { "title": "QA Evidence for {{ commit }}", "markup": "ci/front_page.pml" },
      "artifacts": [
        { "id": "tests-summary", "title": "Test Summary", "path": "ci/tests/summary.json", "media_type": "application/json", "render": "summary:test", "sha256": "0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef" }
      ]
    }
  ]
}
